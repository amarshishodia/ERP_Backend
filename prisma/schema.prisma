generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model user {
  id             Int           @id @default(autoincrement())
  username       String        @unique
  password       String
  role           String
  email          String?       @unique
  salary         Int?
  designation_id Int?
  company_id     Int?
  join_date      DateTime?
  leave_date     DateTime?
  id_no          String?       @unique
  department     String?
  phone          String?       @unique
  address        String?
  blood_group    String?
  image          String?
  status         Boolean       @default(true)
  is_super_admin Boolean       @default(false)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  saleInvoice      saleInvoice[]
  quotationInvoice quotationInvoice[]
  challanInvoice   challanInvoice[]
  sales_orders     sales_order[]
  purchase_orders   purchase_order[]
  designation      designation?        @relation(fields: [designation_id], references: [id])
  company          appSetting?          @relation(fields: [company_id], references: [id])
  product_sale_histories product_sale_history[]
  ecommerce_wishlist     ecommerce_wishlist[]  // customer_id in wishlist references user (e-commerce)
  ecommerce_cart         ecommerce_cart[]      // customer_id in cart references user (e-commerce)

  @@index([designation_id], map: "user_designation_id_fkey")
  @@index([company_id])
}

model designation {
  id        Int      @id @default(autoincrement())
  name      String
  company_id Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      user[]
  company   appSetting @relation(fields: [company_id], references: [id])

  @@unique([name, company_id])
  @@index([company_id])
}

model product {
  id                           Int                            @id @default(autoincrement())
  name                         String?
  isbn                         String                         @unique
  author                       String?
  quantity                     Int                            @default(0)
  purchase_price               Float?
  sale_price                   Float
  imageName                    String?
  product_category_id          Int?
  product_currency_id          Int?
  book_publisher_id            Int?
  unit_measurement             Float?
  unit_type                    String?
  reorder_quantity             Int?
  status                       Boolean                        @default(true)
  created_at                   DateTime                       @default(now())
  updated_at                   DateTime                       @updatedAt
  sku                          String?                        @db.Text
  book_publisher               book_publisher?                @relation(fields: [book_publisher_id], references: [id])
  product_category             product_category?              @relation("ProductPrimaryCategory", fields: [product_category_id], references: [id])
  product_currency             product_currency?              @relation(fields: [product_currency_id], references: [id])
  product_categories           product_product_category[]
  purchaseInvoiceProduct       purchaseInvoiceProduct[]
  returnPurchaseInvoiceProduct returnPurchaseInvoiceProduct[]
  returnSaleInvoiceProduct     returnSaleInvoiceProduct[]
  saleInvoiceProduct           saleInvoiceProduct[]
  quotationInvoiceProduct      quotationInvoiceProduct[]
  challanInvoiceProduct        challanInvoiceProduct[]
  product_stock                product_stock[]
  stock_entries                stock[]
  product_purchase_history     product_purchase_history[]
  product_sale_history         product_sale_history[]
  ecommerce_wishlist           ecommerce_wishlist[]
  ecommerce_cart               ecommerce_cart[]
  ecommerce_order_items        ecommerce_order_item[]
  sales_order_items            sales_order_item[]
  purchase_order_items          purchase_order_item[]

  @@index([book_publisher_id], map: "product_book_publisher_id_fkey")
  @@index([product_category_id], map: "product_product_category_id_fkey")
  @@index([product_currency_id], map: "product_product_currency_id_fkey")
  @@index([name], map: "product_name_idx")
  @@index([author], map: "product_author_idx")
  @@index([isbn], map: "product_isbn_idx")
  @@index([sku(length: 100)], map: "product_sku_idx")
  @@index([status], map: "product_status_idx")
}

model product_category {
  id        Int       @id @default(autoincrement())
  name      String
  company_id Int
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  product   product[] @relation("ProductPrimaryCategory")
  products  product_product_category[]
  company   appSetting @relation(fields: [company_id], references: [id])

  @@unique([name, company_id])
  @@index([company_id])
}

model product_product_category {
  id                  Int              @id @default(autoincrement())
  product_id          Int
  product_category_id Int
  created_at          DateTime         @default(now())
  product             product           @relation(fields: [product_id], references: [id], onDelete: Cascade)
  product_category    product_category  @relation(fields: [product_category_id], references: [id], onDelete: Cascade)

  @@unique([product_id, product_category_id])
  @@index([product_id])
  @@index([product_category_id])
}

model book_publisher {
  id         Int       @id @default(autoincrement())
  name       String
  company_id Int
  address    String?
  phone      String?
  email      String?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  product    product[]
  company    appSetting @relation(fields: [company_id], references: [id])
  discounts  discount_master[]

  @@unique([name, company_id])
  @@index([name], map: "book_publisher_name_idx")
  @@index([company_id])
}

model product_currency {
  id                Int                      @id @default(autoincrement())
  name              String
  symbol            String
  company_id        Int
  conversion        Float                    // Keep for backward compatibility, will use latest rate
  effective_from_date DateTime?              // Keep for backward compatibility
  createdAt         DateTime                 @default(now())
  updatedAt         DateTime                 @updatedAt
  product           product[]
  currency_rates   product_currency_rate[]
  company           appSetting               @relation(fields: [company_id], references: [id])

  @@unique([name, company_id])
  @@unique([symbol, company_id])
  @@index([company_id])
}

model product_currency_rate {
  id                Int              @id @default(autoincrement())
  product_currency_id Int
  conversion        Float
  effective_from_date DateTime
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  product_currency  product_currency @relation(fields: [product_currency_id], references: [id], onDelete: Cascade)

  @@index([product_currency_id])
  @@index([effective_from_date])
}

model supplier {
  id              Int               @id @default(autoincrement())
  name            String
  phone           String
  address         String
  company_id      Int
  status          Boolean           @default(true)
  created_at      DateTime          @default(now())
  updated_at      DateTime          @updatedAt
  purchaseInvoice purchaseInvoice[]
  purchase_orders purchase_order[]
  company         appSetting        @relation(fields: [company_id], references: [id])
  product_purchase_histories product_purchase_history[]
  purchase_discounts discount_master[]

  @@unique([phone, company_id])
  @@index([company_id])
}

model purchaseInvoice {
  id                     Int                      @id @default(autoincrement())
  date                   DateTime
  total_amount           Float
  discount               Float
  paid_amount            Float
  due_amount             Float
  total_product_discount Float?
  round_off_enabled      Boolean?                 @default(false)
  round_off_amount       Float?                   @default(0)
  supplier_id            Int
  company_id             Int
  sales_order_id         Int?
  purchase_order_id      Int?
  note                   String?
  supplier_memo_no       String?
  created_at             DateTime                 @default(now())
  updated_at             DateTime                 @updatedAt
  supplier               supplier                 @relation(fields: [supplier_id], references: [id], onDelete: Cascade)
  company                appSetting               @relation(fields: [company_id], references: [id])
  sales_order            sales_order?             @relation(fields: [sales_order_id], references: [id], onDelete: SetNull)
  purchase_order         purchase_order?          @relation(fields: [purchase_order_id], references: [id], onDelete: SetNull)
  returnPurchaseInvoice  returnPurchaseInvoice[]
  purchaseInvoiceProduct purchaseInvoiceProduct[]
  product_purchase_histories product_purchase_history[]

  @@index([supplier_id], map: "purchaseInvoice_supplier_id_fkey")
  @@index([company_id])
  @@index([sales_order_id])
  @@index([purchase_order_id])
}

model purchaseInvoiceProduct {
  id                        Int             @id @default(autoincrement())
  product_id                Int
  invoice_id                Int
  product_quantity          Int
  product_purchase_price    Float
  product_purchase_discount Float?
  created_at                DateTime        @default(now())
  updated_at                DateTime        @updatedAt
  product                   product         @relation(fields: [product_id], references: [id], onDelete: Cascade)
  purchaseInvoice           purchaseInvoice @relation(fields: [invoice_id], references: [id], onDelete: Cascade)

  @@index([invoice_id], map: "purchaseInvoiceProduct_invoice_id_fkey")
  @@index([product_id], map: "purchaseInvoiceProduct_product_id_fkey")
}

model customer {
  id                 Int                   @id @default(autoincrement())
  name               String
  phone              String
  address            String
  status             Boolean               @default(true)
  company_id         Int
  created_at         DateTime              @default(now())
  updated_at         DateTime              @updatedAt
  company            appSetting            @relation(fields: [company_id], references: [id])
  saleInvoice        saleInvoice[]
  quotationInvoice   quotationInvoice[]
  challanInvoice     challanInvoice[]
  sales_orders       sales_order[]
  product_sale_histories product_sale_history[]
  sale_discounts     discount_master[]
  ecommerce_orders   ecommerce_order[]

  @@unique([phone, company_id])
}

model saleInvoice {
  id                     Int                  @id @default(autoincrement())
  date                   DateTime
  invoice_number         Int
  total_amount           Float
  discount               Float
  paid_amount            Float
  due_amount             Float
  total_product_discount Float?
  total_product_qty      Int?
  profit                 Float
  customer_id            Int
  user_id                Int
  company_id             Int
  sales_order_id          Int?
  note                   String?
  round_off_enabled      Boolean?             @default(false)
  round_off_amount       Float?               @default(0)
  created_at             DateTime             @default(now())
  updated_at             DateTime             @updatedAt
  invoice_order_date     DateTime?
  invoice_order_number   String?
  prefix                 String?
  customer               customer             @relation(fields: [customer_id], references: [id], onDelete: Cascade)
  user                   user                 @relation(fields: [user_id], references: [id], onDelete: NoAction)
  company                appSetting           @relation(fields: [company_id], references: [id])
  sales_order            sales_order?         @relation(fields: [sales_order_id], references: [id], onDelete: SetNull)
  saleInvoiceProduct     saleInvoiceProduct[]
  returnSaleInvoice      returnSaleInvoice[]
  product_sale_histories product_sale_history[]

  @@index([customer_id], map: "saleInvoice_customer_id_fkey")
  @@index([user_id], map: "saleInvoice_user_id_fkey")
  @@index([sales_order_id])
}

model saleInvoiceProduct {
  id                      Int         @id @default(autoincrement())
  product_id              Int
  invoice_id              Int
  product_quantity        Int
  product_sale_price      Float
  product_sale_discount   Float?
  product_sale_currency   String?
  product_sale_conversion Float?
  created_at              DateTime    @default(now())
  updated_at              DateTime    @updatedAt
  product                 product     @relation(fields: [product_id], references: [id], onDelete: Cascade)
  saleInvoice             saleInvoice @relation(fields: [invoice_id], references: [id])

  @@index([invoice_id], map: "saleInvoiceProduct_invoice_id_fkey")
  @@index([product_id], map: "saleInvoiceProduct_product_id_fkey")
}

model transaction {
  id              Int         @id @default(autoincrement())
  date            DateTime
  debit_id        Int
  credit_id       Int
  sub_debit_id    Int?
  sub_credit_id   Int?
  particulars     String
  amount          Float
  type            String?
  related_id      Int?
  payment_method  String?
  reference_number String?
  status          Boolean     @default(true)
  company_id      Int
  created_at      DateTime    @default(now())
  updated_at      DateTime    @updatedAt
  debit           account     @relation("TransactionDebit", fields: [debit_id], references: [id])
  credit          account     @relation("TransactionCredit", fields: [credit_id], references: [id])
  subDebit        subAccount? @relation("TransactionSubDebit", fields: [sub_debit_id], references: [id])
  subCredit       subAccount? @relation("TransactionSubCredit", fields: [sub_credit_id], references: [id])
  company         appSetting  @relation(fields: [company_id], references: [id])

  @@index([credit_id], map: "transaction_credit_id_fkey")
  @@index([debit_id], map: "transaction_debit_id_fkey")
  @@index([sub_credit_id], map: "transaction_sub_credit_id_fkey")
  @@index([sub_debit_id], map: "transaction_sub_debit_id_fkey")
  @@index([company_id])
}

model role {
  id             Int              @id @default(autoincrement())
  name           String
  company_id     Int
  status         Boolean          @default(true)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  rolePermission rolePermission[]
  company        appSetting       @relation(fields: [company_id], references: [id])

  @@unique([name, company_id])
  @@index([company_id])
}

model permission {
  id             Int              @id @default(autoincrement())
  name           String           @unique
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  rolePermission rolePermission[]
}

model rolePermission {
  id            Int        @id @default(autoincrement())
  role_id       Int
  permission_id Int
  status        Boolean    @default(true)
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  permission    permission @relation(fields: [permission_id], references: [id], onDelete: Cascade)
  role          role       @relation(fields: [role_id], references: [id], onDelete: Cascade)

  @@unique([role_id, permission_id])
  @@index([permission_id], map: "rolePermission_permission_id_fkey")
}

model account {
  id                 Int           @id @default(autoincrement())
  name               String
  type               String
  company_id         Int
  subAccount         subAccount[]
  debitTransactions  transaction[] @relation("TransactionDebit")
  creditTransactions transaction[] @relation("TransactionCredit")
  company            appSetting    @relation(fields: [company_id], references: [id])

  @@unique([name, company_id])
  @@index([company_id])
}

model subAccount {
  id                Int           @id @default(autoincrement())
  name              String        @unique
  account_id        Int
  status            Boolean       @default(true)
  account           account       @relation(fields: [account_id], references: [id], onDelete: NoAction)
  debitTransactions transaction[] @relation("TransactionSubDebit")
  creditTransactions transaction[] @relation("TransactionSubCredit")

  @@index([account_id], map: "subAccount_account_id_fkey")
}

model returnPurchaseInvoice {
  id                           Int                            @id @default(autoincrement())
  date                         DateTime
  total_amount                 Float
  note                         String?
  purchaseInvoice_id           Int
  company_id                   Int
  status                       Boolean                        @default(true)
  created_at                   DateTime                       @default(now())
  updated_at                   DateTime                       @updatedAt
  purchaseInvoice              purchaseInvoice                @relation(fields: [purchaseInvoice_id], references: [id], onDelete: Cascade)
  company                      appSetting                     @relation(fields: [company_id], references: [id])
  returnPurchaseInvoiceProduct returnPurchaseInvoiceProduct[]

  @@index([purchaseInvoice_id], map: "returnPurchaseInvoice_purchaseInvoice_id_fkey")
  @@index([company_id])
}

model returnPurchaseInvoiceProduct {
  id                     Int                   @id @default(autoincrement())
  product_id             Int
  invoice_id             Int
  product_quantity       Int
  product_purchase_price Float
  product_discount       Float?
  created_at             DateTime              @default(now())
  updated_at             DateTime              @updatedAt
  product                product               @relation(fields: [product_id], references: [id], onDelete: Cascade)
  returnPurchaseInvoice  returnPurchaseInvoice @relation(fields: [invoice_id], references: [id], onDelete: Cascade)

  @@index([invoice_id], map: "returnPurchaseInvoiceProduct_invoice_id_fkey")
  @@index([product_id], map: "returnPurchaseInvoiceProduct_product_id_fkey")
}

model returnSaleInvoice {
  id                       Int                        @id @default(autoincrement())
  date                     DateTime
  total_amount             Float
  note                     String?
  saleInvoice_id           Int
  company_id               Int
  status                   Boolean                    @default(true)
  created_at               DateTime                   @default(now())
  updated_at               DateTime                   @updatedAt
  saleInvoice              saleInvoice                @relation(fields: [saleInvoice_id], references: [id], onDelete: Cascade)
  company                  appSetting                 @relation(fields: [company_id], references: [id])
  returnSaleInvoiceProduct returnSaleInvoiceProduct[]

  @@index([saleInvoice_id], map: "returnSaleInvoice_saleInvoice_id_fkey")
}

model returnSaleInvoiceProduct {
  id                 Int               @id @default(autoincrement())
  product_id         Int
  invoice_id         Int
  product_quantity   Int
  product_sale_price Float
  created_at         DateTime          @default(now())
  updated_at         DateTime          @updatedAt
  product            product           @relation(fields: [product_id], references: [id], onDelete: Cascade)
  returnSaleInvoice  returnSaleInvoice @relation(fields: [invoice_id], references: [id], onDelete: Cascade)

  @@index([invoice_id], map: "returnSaleInvoiceProduct_invoice_id_fkey")
  @@index([product_id], map: "returnSaleInvoiceProduct_product_id_fkey")
}

model quotationInvoice {
  id                     Int                        @id @default(autoincrement())
  date                   DateTime
  invoice_number         Int
  total_amount           Float
  discount               Float
  total_product_discount Float?
  total_product_qty      Int?
  customer_id            Int
  user_id                Int
  company_id             Int
  note                   String?
  round_off_enabled      Boolean?                   @default(false)
  round_off_amount       Float?                     @default(0)
  created_at             DateTime                   @default(now())
  updated_at             DateTime                   @updatedAt
  invoice_order_date     DateTime?
  invoice_order_number   String?
  prefix                 String?
  customer               customer                   @relation(fields: [customer_id], references: [id], onDelete: Cascade)
  user                   user                       @relation(fields: [user_id], references: [id], onDelete: NoAction)
  company                appSetting                 @relation(fields: [company_id], references: [id])
  quotationInvoiceProduct quotationInvoiceProduct[]

  @@index([customer_id], map: "quotationInvoice_customer_id_fkey")
  @@index([user_id], map: "quotationInvoice_user_id_fkey")
}

model quotationInvoiceProduct {
  id                      Int              @id @default(autoincrement())
  product_id              Int
  invoice_id              Int
  product_quantity        Int
  product_sale_price       Float
  product_sale_discount    Float?
  product_sale_currency    String?
  product_sale_conversion  Float?
  created_at              DateTime         @default(now())
  updated_at              DateTime          @updatedAt
  product                 product           @relation(fields: [product_id], references: [id], onDelete: Cascade)
  quotationInvoice        quotationInvoice @relation(fields: [invoice_id], references: [id])

  @@index([invoice_id], map: "quotationInvoiceProduct_invoice_id_fkey")
  @@index([product_id], map: "quotationInvoiceProduct_product_id_fkey")
}

model challanInvoice {
  id                     Int                   @id @default(autoincrement())
  date                   DateTime
  invoice_number         Int
  total_amount           Float
  discount               Float
  total_product_discount Float?
  total_product_qty      Int?
  customer_id            Int
  user_id                Int
  company_id             Int
  note                   String?
  round_off_enabled      Boolean?             @default(false)
  round_off_amount       Float?               @default(0)
  created_at             DateTime              @default(now())
  updated_at             DateTime              @updatedAt
  invoice_order_date     DateTime?
  invoice_order_number    String?
  prefix                 String?
  customer               customer              @relation(fields: [customer_id], references: [id], onDelete: Cascade)
  user                   user                  @relation(fields: [user_id], references: [id], onDelete: NoAction)
  company                appSetting            @relation(fields: [company_id], references: [id])
  challanInvoiceProduct  challanInvoiceProduct[]

  @@index([customer_id], map: "challanInvoice_customer_id_fkey")
  @@index([user_id], map: "challanInvoice_user_id_fkey")
}

model challanInvoiceProduct {
  id                      Int             @id @default(autoincrement())
  product_id              Int
  invoice_id              Int
  product_quantity        Int
  product_sale_price      Float
  product_sale_discount   Float?
  product_sale_currency   String?
  product_sale_conversion Float?
  created_at              DateTime        @default(now())
  updated_at              DateTime        @updatedAt
  product                 product         @relation(fields: [product_id], references: [id], onDelete: Cascade)
  challanInvoice          challanInvoice  @relation(fields: [invoice_id], references: [id])

  @@index([invoice_id], map: "challanInvoiceProduct_invoice_id_fkey")
  @@index([product_id], map: "challanInvoiceProduct_product_id_fkey")
}

model appSetting {
  id                 Int     @id @default(autoincrement())
  company_name       String
  tag_line           String?
  address            String
  phone              String
  email              String?
  website            String?
  bank_name          String?
  account_name       String?
  account_number     String?
  ifsc               String?
  terms              String? @db.LongText
  logo               String?
  sale_invoice_prefix String? @default("INV/25-26/")
  quotation_prefix   String? @default("QTN/25-26/")
  challan_prefix      String? @default("CHL/25-26/")
  sale_invoice_terms  String? @db.LongText
  quotation_terms     String? @db.LongText
  challan_terms       String? @db.LongText
  status             Boolean  @default(true)
  users              user[]
  accounts           account[]
  transactions       transaction[]
  designations       designation[]
  roles              role[]
  book_publishers    book_publisher[]
  product_categories product_category[]
  product_currencies product_currency[]
  suppliers          supplier[]
  purchaseInvoices   purchaseInvoice[]
  returnPurchaseInvoices returnPurchaseInvoice[]
  challanInvoices    challanInvoice[]
  customers          customer[]
  saleInvoices       saleInvoice[]
  quotationInvoices  quotationInvoice[]
  returnSaleInvoices returnSaleInvoice[]
  product_stocks     product_stock[]
  locations         location[]
  stocks            stock[]
  product_purchase_histories product_purchase_history[]
  product_sale_histories     product_sale_history[]
  discount_masters   discount_master[]
  ecommerce_orders  ecommerce_order[]
  sales_orders      sales_order[]
  purchase_orders   purchase_order[]
}

model firm {
  id      Int      @id @default(autoincrement())
  name    String
  address String
  phone   String
  email   String
  website String
  prefix  prefix[]
}

model module {
  id     Int      @id @default(autoincrement())
  name   String
  prefix prefix[]
}

model prefix {
  id        Int    @id @default(autoincrement())
  firm_id   Int
  module_id Int
  value     String
  firm      firm   @relation(fields: [firm_id], references: [id], onDelete: Cascade)
  module    module @relation(fields: [module_id], references: [id], onDelete: Cascade)

  @@index([firm_id], map: "prefix_firm_id_fkey")
  @@index([module_id], map: "prefix_module_id_fkey")
}

model product_stock {
  id                Int       @id @default(autoincrement())
  product_id        Int
  company_id        Int
  quantity          Int       @default(0)
  reorder_quantity  Int?
  created_at        DateTime  @default(now())
  updated_at        DateTime  @updatedAt
  product           product   @relation(fields: [product_id], references: [id], onDelete: Cascade)
  company           appSetting @relation(fields: [company_id], references: [id], onDelete: Cascade)

  @@unique([product_id, company_id])
  @@index([product_id])
  @@index([company_id])
}

model location {
  id         Int      @id @default(autoincrement())
  name       String
  company_id Int
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  company    appSetting @relation(fields: [company_id], references: [id], onDelete: Cascade)
  stock_entries stock[]

  @@unique([name, company_id])
  @@index([company_id])
}

model stock {
  id                Int       @id @default(autoincrement()) @map("stockId")
  company_id        Int
  product_id        Int       @map("productId")
  location_id       Int       @map("locationId")
  transaction_date  DateTime  @map("transactionDate")
  purchase_price    Float     @map("purchasePrice")
  quantity          Int
  status            Boolean   @default(true)
  created_date      DateTime  @default(now()) @map("createdDate")
  product           product   @relation(fields: [product_id], references: [id], onDelete: Cascade)
  company           appSetting @relation(fields: [company_id], references: [id], onDelete: Cascade)
  location          location  @relation(fields: [location_id], references: [id], onDelete: Cascade)

  @@index([product_id])
  @@index([company_id])
  @@index([location_id])
  @@index([transaction_date])
}

model product_purchase_history {
  id                    Int       @id @default(autoincrement())
  product_id            Int
  company_id            Int
  purchase_invoice_id   Int?
  supplier_id           Int?
  quantity              Int
  purchase_price        Float
  discount              Float?    @default(0)
  total_amount          Float
  purchase_date         DateTime
  note                  String?
  created_at            DateTime  @default(now())
  updated_at            DateTime  @updatedAt
  product               product   @relation(fields: [product_id], references: [id], onDelete: Cascade)
  company               appSetting @relation(fields: [company_id], references: [id], onDelete: Cascade)
  purchaseInvoice       purchaseInvoice? @relation(fields: [purchase_invoice_id], references: [id], onDelete: SetNull)
  supplier              supplier? @relation(fields: [supplier_id], references: [id], onDelete: SetNull)

  @@index([product_id])
  @@index([company_id])
  @@index([purchase_invoice_id])
  @@index([supplier_id])
  @@index([purchase_date])
}

model product_sale_history {
  id                  Int       @id @default(autoincrement())
  product_id          Int
  company_id          Int
  sale_invoice_id     Int?
  customer_id         Int?
  user_id             Int?
  quantity            Int
  sale_price          Float
  discount            Float?    @default(0)
  total_amount        Float
  profit              Float?
  sale_date           DateTime
  note                String?
  created_at          DateTime  @default(now())
  updated_at          DateTime  @updatedAt
  product             product   @relation(fields: [product_id], references: [id], onDelete: Cascade)
  company             appSetting @relation(fields: [company_id], references: [id], onDelete: Cascade)
  saleInvoice         saleInvoice? @relation(fields: [sale_invoice_id], references: [id], onDelete: SetNull)
  customer            customer? @relation(fields: [customer_id], references: [id], onDelete: SetNull)
  user                user?     @relation(fields: [user_id], references: [id], onDelete: SetNull)

  @@index([product_id])
  @@index([company_id])
  @@index([sale_invoice_id])
  @@index([customer_id])
  @@index([user_id])
  @@index([sale_date])
}

model discount_master {
  id                  Int       @id @default(autoincrement())
  company_id          Int
  discount_type       String    // "sale" or "purchase"
  publisher_id        Int       // book_publisher_id (required)
  customer_id         Int?      // customer_id (required for sale discounts)
  supplier_id         Int?      // supplier_id (required for purchase discounts)
  discount_value      Float     // Discount amount (percentage or fixed)
  discount_unit       String    // "percentage" or "fixed"
  status              Boolean   @default(true)
  effective_from      DateTime?
  effective_to        DateTime?
  description         String?   @db.Text
  created_at          DateTime  @default(now())
  updated_at          DateTime  @updatedAt
  company             appSetting @relation(fields: [company_id], references: [id], onDelete: Cascade)
  publisher           book_publisher @relation(fields: [publisher_id], references: [id], onDelete: Cascade)
  customer            customer? @relation(fields: [customer_id], references: [id], onDelete: Cascade)
  supplier            supplier? @relation(fields: [supplier_id], references: [id], onDelete: Cascade)

  @@index([company_id])
  @@index([discount_type])
  @@index([publisher_id])
  @@index([customer_id])
  @@index([supplier_id])
  @@index([status])
  @@index([effective_from])
  @@index([effective_to])
}

model ecommerce_banner {
  id          Int       @id @default(autoincrement())
  title       String?
  description String?   @db.Text
  image_url   String
  link_url    String?
  position    String    @default("homepage") // homepage, category, etc.
  order       Int       @default(0)
  status      Boolean   @default(true)
  start_date  DateTime?
  end_date    DateTime?
  created_at  DateTime  @default(now())
  updated_at  DateTime  @updatedAt

  @@index([status])
  @@index([position])
  @@index([order])
}

model ecommerce_wishlist {
  id          Int       @id @default(autoincrement())
  product_id  Int
  customer_id Int?      // Logged-in user id (user table) or null for guest
  session_id  String?   // For guest users
  created_at  DateTime  @default(now())
  updated_at  DateTime  @updatedAt
  product     product   @relation(fields: [product_id], references: [id], onDelete: Cascade)
  user        user?     @relation(fields: [customer_id], references: [id], onDelete: Cascade)

  @@unique([product_id, customer_id])
  @@unique([product_id, session_id])
  @@index([product_id])
  @@index([customer_id])
  @@index([session_id])
}

model ecommerce_cart {
  id          Int       @id @default(autoincrement())
  product_id  Int
  quantity    Int       @default(1)
  customer_id Int?      // Logged-in user id (user table) or null for guest
  session_id  String?   // For guest users
  created_at  DateTime  @default(now())
  updated_at  DateTime  @updatedAt
  product     product   @relation(fields: [product_id], references: [id], onDelete: Cascade)
  user        user?     @relation(fields: [customer_id], references: [id], onDelete: Cascade)

  @@unique([product_id, customer_id])
  @@unique([product_id, session_id])
  @@index([product_id])
  @@index([customer_id])
  @@index([session_id])
}

model ecommerce_order {
  id                  Int       @id @default(autoincrement())
  order_number        String    @unique
  customer_id         Int?      // Optional for guest checkout
  customer_name       String    // Required for order
  customer_phone      String    // Required for order
  customer_email      String?
  customer_address    String    // Required for order
  company_id          Int?      // Company/client from which products were purchased
  total_amount        Float
  discount            Float     @default(0)
  paid_amount         Float     @default(0)
  due_amount          Float
  status              String    @default("pending") // pending, confirmed, processing, shipped, delivered, cancelled
  payment_status      String    @default("pending") // pending, paid, partial, refunded
  payment_method      String?
  shipping_address    String?
  note                String?   @db.Text
  session_id          String?   // For guest orders
  created_at          DateTime  @default(now())
  updated_at          DateTime  @updatedAt
  customer            customer? @relation(fields: [customer_id], references: [id], onDelete: SetNull)
  company             appSetting? @relation(fields: [company_id], references: [id], onDelete: SetNull)
  order_items         ecommerce_order_item[]

  @@index([customer_id])
  @@index([company_id])
  @@index([order_number])
  @@index([status])
  @@index([session_id])
}

model ecommerce_order_item {
  id                  Int       @id @default(autoincrement())
  order_id            Int
  product_id          Int
  quantity            Int
  sale_price          Float
  discount            Float     @default(0)
  total_amount        Float
  created_at          DateTime  @default(now())
  updated_at          DateTime  @updatedAt
  order               ecommerce_order @relation(fields: [order_id], references: [id], onDelete: Cascade)
  product             product   @relation(fields: [product_id], references: [id], onDelete: Cascade)

  @@index([order_id])
  @@index([product_id])
}

model sales_order {
  id                  Int                  @id @default(autoincrement())
  order_number        String               @unique
  order_date          DateTime
  customer_id         Int
  company_id          Int
  user_id             Int
  status              String               @default("pending") // pending, partial, fulfilled, cancelled
  total_amount        Float
  discount            Float                @default(0)
  note                String?              @db.Text
  created_at          DateTime             @default(now())
  updated_at          DateTime             @updatedAt
  customer            customer             @relation(fields: [customer_id], references: [id], onDelete: Cascade)
  company             appSetting          @relation(fields: [company_id], references: [id], onDelete: Cascade)
  user                user                 @relation(fields: [user_id], references: [id], onDelete: NoAction)
  order_items         sales_order_item[]
  purchaseInvoices    purchaseInvoice[]
  saleInvoices        saleInvoice[]
  purchase_orders     purchase_order[]

  @@index([customer_id])
  @@index([company_id])
  @@index([user_id])
  @@index([order_number])
  @@index([status])
  @@index([order_date])
}

model sales_order_item {
  id                  Int                  @id @default(autoincrement())
  order_id            Int
  product_id          Int
  ordered_quantity    Int
  fulfilled_quantity  Int                  @default(0)
  sale_price          Float
  discount            Float                 @default(0)
  total_amount        Float
  created_at          DateTime             @default(now())
  updated_at          DateTime             @updatedAt
  order               sales_order           @relation(fields: [order_id], references: [id], onDelete: Cascade)
  product             product              @relation(fields: [product_id], references: [id], onDelete: Cascade)

  @@index([order_id])
  @@index([product_id])
}

model purchase_order {
  id                      Int                  @id @default(autoincrement())
  order_number            String               @unique
  order_date              DateTime
  supplier_id             Int
  company_id              Int
  user_id                 Int
  sales_order_id          Int?
  status                  String               @default("pending") // pending, partial, received, cancelled
  total_amount            Float
  discount                Float                @default(0)
  expected_delivery_date  DateTime?
  note                    String?              @db.Text
  created_at              DateTime             @default(now())
  updated_at              DateTime             @updatedAt
  supplier                supplier              @relation(fields: [supplier_id], references: [id], onDelete: Cascade)
  company                 appSetting           @relation(fields: [company_id], references: [id], onDelete: Cascade)
  user                    user                 @relation(fields: [user_id], references: [id], onDelete: NoAction)
  sales_order             sales_order?         @relation(fields: [sales_order_id], references: [id], onDelete: SetNull)
  order_items             purchase_order_item[]
  purchaseInvoices        purchaseInvoice[]

  @@index([supplier_id])
  @@index([company_id])
  @@index([user_id])
  @@index([sales_order_id])
  @@index([order_number])
  @@index([status])
  @@index([order_date])
}

model purchase_order_item {
  id                  Int                  @id @default(autoincrement())
  order_id            Int
  product_id          Int
  ordered_quantity    Int
  received_quantity   Int                  @default(0)
  purchase_price      Float
  discount            Float                 @default(0)
  total_amount        Float
  created_at          DateTime             @default(now())
  updated_at          DateTime             @updatedAt
  order               purchase_order        @relation(fields: [order_id], references: [id], onDelete: Cascade)
  product             product              @relation(fields: [product_id], references: [id], onDelete: Cascade)

  @@index([order_id])
  @@index([product_id])
}
